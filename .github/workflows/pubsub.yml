name: Publish message to Pub/Sub

on: push # Trigger on push events to any branch

jobs:
  publish-message:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - id: auth
        name: Authenticate to Google Cloud Platform
        uses: 'google-github-actions/auth@v1'
        with:
          credentials_json: '${{ secrets.GCP_SA_KEY }}'

      - id: publish
        name: Publish a message to Pub/Sub
        uses: google-github-actions/pubsub@v0
        with:
          project-id: ${{ secrets.GCP_PROJECT_ID }}
          pubsub-topic: projects/{{ secrets.GCP_PROJECT_ID }}/topics/{{ secrets.PUBSUB_TOPIC_NAME }}
          message-body: 'This message was published from a GitHub Actions workflow.'
